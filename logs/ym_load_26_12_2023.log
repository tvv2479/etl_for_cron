root 2023-12-26 09:56:57,208 INFO siteInsertOrders(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 09:56:57,366 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 09:56:58,088 INFO Authentication (password) successful!
root 2023-12-26 09:57:02,154 INFO siteInsertOrders(). Uspeshnoe poluchenie dannih.
root 2023-12-26 09:57:02,267 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_insert_order_new.
root 2023-12-26 09:57:02,565 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_insert_order_new.
root 2023-12-26 09:57:02,566 INFO siteUpdateOrders(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 09:57:02,592 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 09:57:03,141 INFO Authentication (password) successful!
root 2023-12-26 09:57:07,003 INFO siteUpdateOrders(). Uspeshnoe poluchenie dannih.
root 2023-12-26 09:57:07,006 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_update_order_new.
root 2023-12-26 09:57:07,181 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_update_order_new.
root 2023-12-26 10:03:45,049 INFO siteInsertBasket(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 10:03:45,086 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 10:03:45,649 INFO Authentication (password) successful!
root 2023-12-26 10:03:49,179 INFO siteInsertBasket(). Uspeshnoe poluchenie dannih.
root 2023-12-26 10:03:49,186 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_insert_basket_new.
root 2023-12-26 10:03:49,410 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_insert_basket_new.
root 2023-12-26 10:03:49,410 INFO siteUpdateBasket(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 10:03:49,443 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 10:03:49,886 INFO Authentication (password) successful!
root 2023-12-26 10:03:53,955 INFO siteUpdateBasket(). Uspeshnoe poluchenie dannih.
root 2023-12-26 10:03:53,966 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_update_basket_new.
root 2023-12-26 10:03:54,595 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_update_basket_new.
root 2023-12-26 10:10:47,189 INFO siteGuest(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 10:10:47,215 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 10:10:47,623 INFO Authentication (password) successful!
root 2023-12-26 10:10:59,171 INFO siteGuest(). Uspeshnoe poluchenie dannih.
root 2023-12-26 10:10:59,197 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_guest_new.
root 2023-12-26 10:10:59,663 ERROR site.dataSiteToBd(). Oshibka zapisi dannih v tab site_guest_new - (psycopg2.errors.StringDataRightTruncation) value too long for type character varying(100)

[SQL: INSERT INTO public.site_guest_new (guest_id, timestamp_x, favorites, c_events, sessions, hits, repair, first_session_id, first_date, first_url_from, first_url_to, first_url_to_404, first_site_id, first_adv_id, first_referer1, first_referer2, first_re ... 748965 characters truncated ... )s, %(last_site_id__907)s, %(last_country_id__907)s, %(last_city_id__907)s, %(last_city_info__907)s)]
[parameters: {'first_session_id__0': 5559781.0, 'last_city_id__0': 6, 'last_url_last__0': 'https://usp-sldnc.top:443/kostyumy_dvoyki/insta_stil_2_v_1_fashion_/', 'last_referer2__0': None, 'timestamp_x__0': None, 'last_user_id__0': 0, 'guest_id__0': 3092251, 'last_url_last_404__0': 'N', 'sessions__0': 1, 'last_adv_back__0': 'N', 'last_cookie__0': None, 'last_date__0': datetime.datetime(2023, 12, 25, 0, 12, 4), 'c_events__0': 0, 'first_date__0': datetime.datetime(2023, 12, 25, 0, 0, 7), 'first_url_from__0': None, 'last_ip__0': '85.208.96.211', 'last_user_agent__0': 'Mozilla/5.0 (compatible; SemrushBot/7~bl; +http://www.semrush.com/bot.html)', 'last_site_id__0': 's1', 'last_city_info__0': 'a:4:{s:2:"LC";s:27:"CCityLookup_geoip_extension";s:2:"LD";a:2:{s:3:"IPA";s:13:"85.208.96.211";s:3:"IPN";s:10:"1439719635";}s:2:"CC";b:0;s:2:"CI";s:1:"6";}', 'first_referer3__0': None, 'last_country_id__0': 'N0', 'hits__0': 2, 'favorites__0': 'N', 'first_adv_id__0': 0, 'last_session_id__0': 5559781, 'last_adv_id__0': None, 'first_url_to__0': 'https://usp-sldnc.top:443/bluzki/pronzitelnye_chuvstva_white/', 'first_site_id__0': 's1', 'first_referer2__0': None, 'last_referer3__0': None, 'last_language__0': None, 'last_referer1__0': None, 'first_url_to_404__0': 'N', 'last_user_auth__0': 'N', 'first_referer1__0': None, 'repair__0': 'N', 'first_session_id__1': 5559783.0, 'last_city_id__1': 1, 'last_url_last__1': 'https://charutti.ru:443/robots.txt', 'last_referer2__1': None, 'timestamp_x__1': None, 'last_user_id__1': 0, 'guest_id__1': 3092252, 'last_url_last_404__1': 'N', 'sessions__1': 1, 'last_adv_back__1': 'N', 'last_cookie__1': None, 'last_date__1': datetime.datetime(2023, 12, 25, 0, 20, 30), 'c_events__1': 0, 'first_date__1': datetime.datetime(2023, 12, 25, 0, 0, 10) ... 32588 parameters truncated ... 'favorites__906': 'N', 'first_adv_id__906': 0, 'last_session_id__906': 5561335, 'last_adv_id__906': None, 'first_url_to__906': 'https://cherutti.ru:443/kostyumy_dvoyki/gid_modnogo_goroda/', 'first_site_id__906': 's1', 'first_referer2__906': None, 'last_referer3__906': None, 'last_language__906': None, 'last_referer1__906': None, 'first_url_to_404__906': 'N', 'last_user_auth__906': 'N', 'first_referer1__906': None, 'repair__906': 'N', 'first_session_id__907': 5561336.0, 'last_city_id__907': 6, 'last_url_last__907': 'https://charutti.ru:443/platya_charutti/vechernie_platya/fantasticheski_prekrasna_elegantnaya/', 'last_referer2__907': None, 'timestamp_x__907': None, 'last_user_id__907': 0, 'guest_id__907': 3093158, 'last_url_last_404__907': 'N', 'sessions__907': 1, 'last_adv_back__907': 'N', 'last_cookie__907': None, 'last_date__907': datetime.datetime(2023, 12, 25, 3, 2, 55), 'c_events__907': 0, 'first_date__907': datetime.datetime(2023, 12, 25, 3, 2, 55), 'first_url_from__907': None, 'last_ip__907': '85.208.96.193', 'last_user_agent__907': 'Mozilla/5.0 (compatible; SemrushBot/7~bl; +http://www.semrush.com/bot.html)', 'last_site_id__907': 's1', 'last_city_info__907': 'a:4:{s:2:"LC";s:27:"CCityLookup_geoip_extension";s:2:"LD";a:2:{s:3:"IPA";s:13:"85.208.96.193";s:3:"IPN";s:10:"1439719617";}s:2:"CC";b:0;s:2:"CI";s:1:"6";}', 'first_referer3__907': None, 'last_country_id__907': 'N0', 'hits__907': 1, 'favorites__907': 'N', 'first_adv_id__907': 0, 'last_session_id__907': 5561336, 'last_adv_id__907': None, 'first_url_to__907': 'https://charutti.ru:443/platya_charutti/vechernie_platya/fantasticheski_prekrasna_elegantnaya/', 'first_site_id__907': 's1', 'first_referer2__907': None, 'last_referer3__907': None, 'last_language__907': None, 'last_referer1__907': None, 'first_url_to_404__907': 'N', 'last_user_auth__907': 'N', 'first_referer1__907': None, 'repair__907': 'N'}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
Traceback (most recent call last):
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(100)


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "g:\py.projects\tb\data_collection\site_dat\load_data_site.py", line 95, in dataSiteToBd
    df.to_sql(tableName, engine_pg, schema='public', if_exists='append', index=False)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\core\generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1507, in insert_records
    raise err
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_insertmany_context(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.StringDataRightTruncation) value too long for type character varying(100)

[SQL: INSERT INTO public.site_guest_new (guest_id, timestamp_x, favorites, c_events, sessions, hits, repair, first_session_id, first_date, first_url_from, first_url_to, first_url_to_404, first_site_id, first_adv_id, first_referer1, first_referer2, first_re ... 748965 characters truncated ... )s, %(last_site_id__907)s, %(last_country_id__907)s, %(last_city_id__907)s, %(last_city_info__907)s)]
[parameters: {'first_session_id__0': 5559781.0, 'last_city_id__0': 6, 'last_url_last__0': 'https://usp-sldnc.top:443/kostyumy_dvoyki/insta_stil_2_v_1_fashion_/', 'last_referer2__0': None, 'timestamp_x__0': None, 'last_user_id__0': 0, 'guest_id__0': 3092251, 'last_url_last_404__0': 'N', 'sessions__0': 1, 'last_adv_back__0': 'N', 'last_cookie__0': None, 'last_date__0': datetime.datetime(2023, 12, 25, 0, 12, 4), 'c_events__0': 0, 'first_date__0': datetime.datetime(2023, 12, 25, 0, 0, 7), 'first_url_from__0': None, 'last_ip__0': '85.208.96.211', 'last_user_agent__0': 'Mozilla/5.0 (compatible; SemrushBot/7~bl; +http://www.semrush.com/bot.html)', 'last_site_id__0': 's1', 'last_city_info__0': 'a:4:{s:2:"LC";s:27:"CCityLookup_geoip_extension";s:2:"LD";a:2:{s:3:"IPA";s:13:"85.208.96.211";s:3:"IPN";s:10:"1439719635";}s:2:"CC";b:0;s:2:"CI";s:1:"6";}', 'first_referer3__0': None, 'last_country_id__0': 'N0', 'hits__0': 2, 'favorites__0': 'N', 'first_adv_id__0': 0, 'last_session_id__0': 5559781, 'last_adv_id__0': None, 'first_url_to__0': 'https://usp-sldnc.top:443/bluzki/pronzitelnye_chuvstva_white/', 'first_site_id__0': 's1', 'first_referer2__0': None, 'last_referer3__0': None, 'last_language__0': None, 'last_referer1__0': None, 'first_url_to_404__0': 'N', 'last_user_auth__0': 'N', 'first_referer1__0': None, 'repair__0': 'N', 'first_session_id__1': 5559783.0, 'last_city_id__1': 1, 'last_url_last__1': 'https://charutti.ru:443/robots.txt', 'last_referer2__1': None, 'timestamp_x__1': None, 'last_user_id__1': 0, 'guest_id__1': 3092252, 'last_url_last_404__1': 'N', 'sessions__1': 1, 'last_adv_back__1': 'N', 'last_cookie__1': None, 'last_date__1': datetime.datetime(2023, 12, 25, 0, 20, 30), 'c_events__1': 0, 'first_date__1': datetime.datetime(2023, 12, 25, 0, 0, 10) ... 32588 parameters truncated ... 'favorites__906': 'N', 'first_adv_id__906': 0, 'last_session_id__906': 5561335, 'last_adv_id__906': None, 'first_url_to__906': 'https://cherutti.ru:443/kostyumy_dvoyki/gid_modnogo_goroda/', 'first_site_id__906': 's1', 'first_referer2__906': None, 'last_referer3__906': None, 'last_language__906': None, 'last_referer1__906': None, 'first_url_to_404__906': 'N', 'last_user_auth__906': 'N', 'first_referer1__906': None, 'repair__906': 'N', 'first_session_id__907': 5561336.0, 'last_city_id__907': 6, 'last_url_last__907': 'https://charutti.ru:443/platya_charutti/vechernie_platya/fantasticheski_prekrasna_elegantnaya/', 'last_referer2__907': None, 'timestamp_x__907': None, 'last_user_id__907': 0, 'guest_id__907': 3093158, 'last_url_last_404__907': 'N', 'sessions__907': 1, 'last_adv_back__907': 'N', 'last_cookie__907': None, 'last_date__907': datetime.datetime(2023, 12, 25, 3, 2, 55), 'c_events__907': 0, 'first_date__907': datetime.datetime(2023, 12, 25, 3, 2, 55), 'first_url_from__907': None, 'last_ip__907': '85.208.96.193', 'last_user_agent__907': 'Mozilla/5.0 (compatible; SemrushBot/7~bl; +http://www.semrush.com/bot.html)', 'last_site_id__907': 's1', 'last_city_info__907': 'a:4:{s:2:"LC";s:27:"CCityLookup_geoip_extension";s:2:"LD";a:2:{s:3:"IPA";s:13:"85.208.96.193";s:3:"IPN";s:10:"1439719617";}s:2:"CC";b:0;s:2:"CI";s:1:"6";}', 'first_referer3__907': None, 'last_country_id__907': 'N0', 'hits__907': 1, 'favorites__907': 'N', 'first_adv_id__907': 0, 'last_session_id__907': 5561336, 'last_adv_id__907': None, 'first_url_to__907': 'https://charutti.ru:443/platya_charutti/vechernie_platya/fantasticheski_prekrasna_elegantnaya/', 'first_site_id__907': 's1', 'first_referer2__907': None, 'last_referer3__907': None, 'last_language__907': None, 'last_referer1__907': None, 'first_url_to_404__907': 'N', 'last_user_auth__907': 'N', 'first_referer1__907': None, 'repair__907': 'N'}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
root 2023-12-26 10:15:31,532 INFO siteGuest(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 10:15:31,561 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 10:15:32,056 INFO Authentication (password) successful!
root 2023-12-26 10:15:41,763 INFO siteGuest(). Uspeshnoe poluchenie dannih.
root 2023-12-26 10:15:41,787 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_guest_new.
root 2023-12-26 10:15:43,474 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_guest_new.
root 2023-12-26 10:16:20,038 INFO siteInsertFuser(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 10:16:20,068 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 10:16:20,502 INFO Authentication (password) successful!
root 2023-12-26 10:16:21,754 INFO siteInsertFuser(). Uspeshnoe poluchenie dannih.
root 2023-12-26 10:16:21,761 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_insert_fuser_new.
root 2023-12-26 10:16:22,680 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_insert_fuser_new.
root 2023-12-26 10:16:22,680 INFO siteUpdateFuser(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 10:16:22,705 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 10:16:23,115 INFO Authentication (password) successful!
root 2023-12-26 10:16:24,508 INFO siteUpdateFuser(). Uspeshnoe poluchenie dannih.
root 2023-12-26 10:16:24,514 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_update_fuser_new.
root 2023-12-26 10:16:24,755 ERROR site.dataSiteToBd(). Oshibka zapisi dannih v tab site_update_fuser_new - (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "site_update_fuser_new_fuser_id_key"
DETAIL:  Key (fuser_id)=(11447) already exists.

[SQL: INSERT INTO public.site_update_fuser_new (fuser_id, date_insert, date_update, user_id, code) VALUES (%(fuser_id__0)s, %(date_insert__0)s, %(date_update__0)s, %(user_id__0)s, %(code__0)s), (%(fuser_id__1)s, %(date_insert__1)s, %(date_update__1)s, %(us ... 97198 characters truncated ... s), (%(fuser_id__999)s, %(date_insert__999)s, %(date_update__999)s, %(user_id__999)s, %(code__999)s)]
[parameters: {'code__0': '7e66e49a7a44727a0b656cc67c2b24b1', 'user_id__0': 8865.0, 'date_insert__0': datetime.datetime(2015, 11, 27, 15, 22, 4), 'date_update__0': datetime.datetime(2023, 12, 25, 18, 16, 19), 'fuser_id__0': 7099, 'code__1': '45e3752f06265331979fc8d80bbcf7b3', 'user_id__1': 10457.0, 'date_insert__1': datetime.datetime(2015, 11, 27, 15, 48, 18), 'date_update__1': datetime.datetime(2023, 12, 25, 13, 0, 42), 'fuser_id__1': 7193, 'code__2': '2a48f5659d9df7706375b0995efa221c', 'user_id__2': 9959.0, 'date_insert__2': datetime.datetime(2015, 11, 27, 15, 51, 7), 'date_update__2': datetime.datetime(2023, 12, 25, 9, 54, 57), 'fuser_id__2': 7202, 'code__3': 'd7a535f8c99a4aca13e0269796e0f5cd', 'user_id__3': 10583.0, 'date_insert__3': datetime.datetime(2015, 11, 27, 20, 1, 20), 'date_update__3': datetime.datetime(2023, 12, 25, 21, 28, 22), 'fuser_id__3': 9457, 'code__4': '46a2cf1336257da3012003cd473620c4', 'user_id__4': 10855.0, 'date_insert__4': datetime.datetime(2015, 11, 27, 20, 10, 15), 'date_update__4': datetime.datetime(2023, 12, 25, 16, 22, 36), 'fuser_id__4': 9521, 'code__5': '677496b94e5d800105df6ba2944f1a3c', 'user_id__5': 12236.0, 'date_insert__5': datetime.datetime(2015, 11, 28, 8, 17, 2), 'date_update__5': datetime.datetime(2023, 12, 25, 13, 35, 12), 'fuser_id__5': 11447, 'code__6': '7dc4a146ddc3bf6398e990a3506b9c4a', 'user_id__6': 11838.0, 'date_insert__6': datetime.datetime(2015, 11, 28, 8, 55, 32), 'date_update__6': datetime.datetime(2023, 12, 25, 23, 41, 19), 'fuser_id__6': 11544, 'code__7': '0a77c5540195739665ee25c7245e0a6b', 'user_id__7': 9040.0, 'date_insert__7': datetime.datetime(2015, 11, 28, 13, 47, 25), 'date_update__7': datetime.datetime(2023, 12, 25, 2, 38, 12), 'fuser_id__7': 12400, 'code__8': '0a76f22a52b5d33f35b549e5fac446ce', 'user_id__8': 18287.0, 'date_insert__8': datetime.datetime(2015, 11, 28, 21, 20, 25), 'date_update__8': datetime.datetime(2023, 12, 25, 3, 34, 54), 'fuser_id__8': 14092, 'code__9': '01ff70e0c5553620cbf33c6006da0195', 'user_id__9': 10286.0, 'date_insert__9': datetime.datetime(2015, 11, 28, 21, 26, 57), 'date_update__9': datetime.datetime(2023, 12, 25, 15, 12, 13), 'fuser_id__9': 14126 ... 4900 parameters truncated ... 'code__990': 'ae545bee2d4748b1484a0dffa62e262d', 'user_id__990': None, 'date_insert__990': datetime.datetime(2023, 12, 22, 19, 17, 36), 'date_update__990': datetime.datetime(2023, 12, 25, 0, 16, 4), 'fuser_id__990': 62495823, 'code__991': '53b5cbbc9b50a82262ccb1e3eb7410b2', 'user_id__991': None, 'date_insert__991': datetime.datetime(2023, 12, 22, 19, 32, 15), 'date_update__991': datetime.datetime(2023, 12, 25, 22, 26, 23), 'fuser_id__991': 62495921, 'code__992': 'bcb2ea1d22870d47691838e3404557d6', 'user_id__992': None, 'date_insert__992': datetime.datetime(2023, 12, 22, 20, 6, 19), 'date_update__992': datetime.datetime(2023, 12, 25, 13, 32, 57), 'fuser_id__992': 62496251, 'code__993': '6d6a172be02a40670db7c593a9a0ddeb', 'user_id__993': None, 'date_insert__993': datetime.datetime(2023, 12, 22, 20, 14, 1), 'date_update__993': datetime.datetime(2023, 12, 25, 1, 17, 13), 'fuser_id__993': 62496307, 'code__994': '0d15a73dcce601a6478dba0082d0eae0', 'user_id__994': None, 'date_insert__994': datetime.datetime(2023, 12, 22, 20, 23, 17), 'date_update__994': datetime.datetime(2023, 12, 25, 21, 46, 18), 'fuser_id__994': 62496362, 'code__995': '38acabc43bd648bdadcea3212f64b29b', 'user_id__995': None, 'date_insert__995': datetime.datetime(2023, 12, 22, 20, 29, 17), 'date_update__995': datetime.datetime(2023, 12, 25, 15, 52, 26), 'fuser_id__995': 62496418, 'code__996': '65fba8a05deec5bebb66cea63291f499', 'user_id__996': None, 'date_insert__996': datetime.datetime(2023, 12, 22, 20, 33, 27), 'date_update__996': datetime.datetime(2023, 12, 25, 0, 27, 3), 'fuser_id__996': 62496441, 'code__997': 'f7a6a241b047930415a578212f2db1e9', 'user_id__997': None, 'date_insert__997': datetime.datetime(2023, 12, 22, 21, 46), 'date_update__997': datetime.datetime(2023, 12, 25, 21, 32, 20), 'fuser_id__997': 62497140, 'code__998': '25da5761ad4bf1af50bc216388705c45', 'user_id__998': None, 'date_insert__998': datetime.datetime(2023, 12, 22, 22, 6, 3), 'date_update__998': datetime.datetime(2023, 12, 25, 15, 24, 16), 'fuser_id__998': 62497338, 'code__999': 'eb4e415bf2ec5a5b919e48ab026e2200', 'user_id__999': None, 'date_insert__999': datetime.datetime(2023, 12, 22, 23, 12, 31), 'date_update__999': datetime.datetime(2023, 12, 25, 20, 56), 'fuser_id__999': 62498040}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "site_update_fuser_new_fuser_id_key"
DETAIL:  Key (fuser_id)=(11447) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "g:\py.projects\tb\data_collection\site_dat\load_data_site.py", line 95, in dataSiteToBd
    df.to_sql(tableName, engine_pg, schema='public', if_exists='append', index=False)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\core\generic.py", line 3008, in to_sql
    return sql.to_sql(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1507, in insert_records
    raise err
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\pandas\io\sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_insertmany_context(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
  File "g:\py.projects\tb\data_collection\.venv\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "site_update_fuser_new_fuser_id_key"
DETAIL:  Key (fuser_id)=(11447) already exists.

[SQL: INSERT INTO public.site_update_fuser_new (fuser_id, date_insert, date_update, user_id, code) VALUES (%(fuser_id__0)s, %(date_insert__0)s, %(date_update__0)s, %(user_id__0)s, %(code__0)s), (%(fuser_id__1)s, %(date_insert__1)s, %(date_update__1)s, %(us ... 97198 characters truncated ... s), (%(fuser_id__999)s, %(date_insert__999)s, %(date_update__999)s, %(user_id__999)s, %(code__999)s)]
[parameters: {'code__0': '7e66e49a7a44727a0b656cc67c2b24b1', 'user_id__0': 8865.0, 'date_insert__0': datetime.datetime(2015, 11, 27, 15, 22, 4), 'date_update__0': datetime.datetime(2023, 12, 25, 18, 16, 19), 'fuser_id__0': 7099, 'code__1': '45e3752f06265331979fc8d80bbcf7b3', 'user_id__1': 10457.0, 'date_insert__1': datetime.datetime(2015, 11, 27, 15, 48, 18), 'date_update__1': datetime.datetime(2023, 12, 25, 13, 0, 42), 'fuser_id__1': 7193, 'code__2': '2a48f5659d9df7706375b0995efa221c', 'user_id__2': 9959.0, 'date_insert__2': datetime.datetime(2015, 11, 27, 15, 51, 7), 'date_update__2': datetime.datetime(2023, 12, 25, 9, 54, 57), 'fuser_id__2': 7202, 'code__3': 'd7a535f8c99a4aca13e0269796e0f5cd', 'user_id__3': 10583.0, 'date_insert__3': datetime.datetime(2015, 11, 27, 20, 1, 20), 'date_update__3': datetime.datetime(2023, 12, 25, 21, 28, 22), 'fuser_id__3': 9457, 'code__4': '46a2cf1336257da3012003cd473620c4', 'user_id__4': 10855.0, 'date_insert__4': datetime.datetime(2015, 11, 27, 20, 10, 15), 'date_update__4': datetime.datetime(2023, 12, 25, 16, 22, 36), 'fuser_id__4': 9521, 'code__5': '677496b94e5d800105df6ba2944f1a3c', 'user_id__5': 12236.0, 'date_insert__5': datetime.datetime(2015, 11, 28, 8, 17, 2), 'date_update__5': datetime.datetime(2023, 12, 25, 13, 35, 12), 'fuser_id__5': 11447, 'code__6': '7dc4a146ddc3bf6398e990a3506b9c4a', 'user_id__6': 11838.0, 'date_insert__6': datetime.datetime(2015, 11, 28, 8, 55, 32), 'date_update__6': datetime.datetime(2023, 12, 25, 23, 41, 19), 'fuser_id__6': 11544, 'code__7': '0a77c5540195739665ee25c7245e0a6b', 'user_id__7': 9040.0, 'date_insert__7': datetime.datetime(2015, 11, 28, 13, 47, 25), 'date_update__7': datetime.datetime(2023, 12, 25, 2, 38, 12), 'fuser_id__7': 12400, 'code__8': '0a76f22a52b5d33f35b549e5fac446ce', 'user_id__8': 18287.0, 'date_insert__8': datetime.datetime(2015, 11, 28, 21, 20, 25), 'date_update__8': datetime.datetime(2023, 12, 25, 3, 34, 54), 'fuser_id__8': 14092, 'code__9': '01ff70e0c5553620cbf33c6006da0195', 'user_id__9': 10286.0, 'date_insert__9': datetime.datetime(2015, 11, 28, 21, 26, 57), 'date_update__9': datetime.datetime(2023, 12, 25, 15, 12, 13), 'fuser_id__9': 14126 ... 4900 parameters truncated ... 'code__990': 'ae545bee2d4748b1484a0dffa62e262d', 'user_id__990': None, 'date_insert__990': datetime.datetime(2023, 12, 22, 19, 17, 36), 'date_update__990': datetime.datetime(2023, 12, 25, 0, 16, 4), 'fuser_id__990': 62495823, 'code__991': '53b5cbbc9b50a82262ccb1e3eb7410b2', 'user_id__991': None, 'date_insert__991': datetime.datetime(2023, 12, 22, 19, 32, 15), 'date_update__991': datetime.datetime(2023, 12, 25, 22, 26, 23), 'fuser_id__991': 62495921, 'code__992': 'bcb2ea1d22870d47691838e3404557d6', 'user_id__992': None, 'date_insert__992': datetime.datetime(2023, 12, 22, 20, 6, 19), 'date_update__992': datetime.datetime(2023, 12, 25, 13, 32, 57), 'fuser_id__992': 62496251, 'code__993': '6d6a172be02a40670db7c593a9a0ddeb', 'user_id__993': None, 'date_insert__993': datetime.datetime(2023, 12, 22, 20, 14, 1), 'date_update__993': datetime.datetime(2023, 12, 25, 1, 17, 13), 'fuser_id__993': 62496307, 'code__994': '0d15a73dcce601a6478dba0082d0eae0', 'user_id__994': None, 'date_insert__994': datetime.datetime(2023, 12, 22, 20, 23, 17), 'date_update__994': datetime.datetime(2023, 12, 25, 21, 46, 18), 'fuser_id__994': 62496362, 'code__995': '38acabc43bd648bdadcea3212f64b29b', 'user_id__995': None, 'date_insert__995': datetime.datetime(2023, 12, 22, 20, 29, 17), 'date_update__995': datetime.datetime(2023, 12, 25, 15, 52, 26), 'fuser_id__995': 62496418, 'code__996': '65fba8a05deec5bebb66cea63291f499', 'user_id__996': None, 'date_insert__996': datetime.datetime(2023, 12, 22, 20, 33, 27), 'date_update__996': datetime.datetime(2023, 12, 25, 0, 27, 3), 'fuser_id__996': 62496441, 'code__997': 'f7a6a241b047930415a578212f2db1e9', 'user_id__997': None, 'date_insert__997': datetime.datetime(2023, 12, 22, 21, 46), 'date_update__997': datetime.datetime(2023, 12, 25, 21, 32, 20), 'fuser_id__997': 62497140, 'code__998': '25da5761ad4bf1af50bc216388705c45', 'user_id__998': None, 'date_insert__998': datetime.datetime(2023, 12, 22, 22, 6, 3), 'date_update__998': datetime.datetime(2023, 12, 25, 15, 24, 16), 'fuser_id__998': 62497338, 'code__999': 'eb4e415bf2ec5a5b919e48ab026e2200', 'user_id__999': None, 'date_insert__999': datetime.datetime(2023, 12, 22, 23, 12, 31), 'date_update__999': datetime.datetime(2023, 12, 25, 20, 56), 'fuser_id__999': 62498040}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
root 2023-12-26 11:07:24,215 INFO siteTransact(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 11:07:24,254 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 11:07:24,801 INFO Authentication (password) successful!
root 2023-12-26 11:07:25,572 INFO siteTransact(). Uspeshnoe poluchenie dannih.
root 2023-12-26 11:07:25,588 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_user_transact.
root 2023-12-26 11:07:25,696 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_user_transact.
root 2023-12-26 11:08:54,295 INFO siteTransact(). Podkluchenie k base site i otptavka zaprosa.
paramiko.transport 2023-12-26 11:08:55,345 INFO Connected (version 2.0, client OpenSSH_7.4)
paramiko.transport 2023-12-26 11:08:55,833 INFO Authentication (password) successful!
root 2023-12-26 11:08:56,506 INFO siteTransact(). Uspeshnoe poluchenie dannih.
root 2023-12-26 11:08:56,508 INFO site.dataSiteToBd(). Zapis dataframe v tablitsu site_user_transact_new.
root 2023-12-26 11:08:56,659 INFO site.dataSiteToBd(). Dataframe uspeshno zapisan v tablitsu - site_user_transact_new.
root 2023-12-26 11:17:21,959 INFO Step_1_hits. Creating a log.
root 2023-12-26 11:17:22,836 INFO Code status 400
NoneType: None
root 2023-12-26 11:17:22,836 INFO Step_1_hits. Successful log request.
root 2023-12-26 11:21:38,038 INFO Step_1_hits. Creating a log.
root 2023-12-26 11:21:38,313 INFO Code status 400
NoneType: None
root 2023-12-26 11:21:38,314 INFO Step_1_hits. Successful log request.
root 2023-12-26 11:26:19,651 INFO Step_1_hits. Creating a log.
root 2023-12-26 11:26:19,856 INFO Code status 400
NoneType: None
root 2023-12-26 11:26:19,856 INFO Step_1_hits. Successful log request.
root 2023-12-26 11:29:39,283 INFO Step_1_hits. Creating a log.
root 2023-12-26 11:29:39,688 INFO Code status 200
NoneType: None
root 2023-12-26 11:29:39,688 INFO Step_1_hits. Successful log request.
root 2023-12-26 11:29:39,688 INFO Step_1_hits. Request number 33139108.
root 2023-12-26 11:29:39,688 INFO Step_1_hits. Request status created.
root 2023-12-26 11:29:39,688 INFO Step_2_hits. Log processing status.
root 2023-12-26 11:29:39,926 INFO Step_2_hits. Loading data. Code 200.
root 2023-12-26 11:31:09,702 INFO Step_2_hits. Number of parts - 1.
root 2023-12-26 11:31:09,702 INFO Step_2_hits. Request status processed.
root 2023-12-26 11:31:09,702 INFO Step_3_hits. Loading the log.
root 2023-12-26 11:31:10,140 INFO Step_3_hits. Loading a log from one part.
root 2023-12-26 11:31:10,141 INFO Step_4_hits. Deleting a log.
root 2023-12-26 11:31:10,438 INFO Step_4_hits. Successful log deletion # 33139108.
root 2023-12-26 11:31:10,439 INFO Step_4_hits. Deleting variables.
root 2023-12-26 11:31:10,443 INFO Start clearing data HITS.
root 2023-12-26 11:31:10,443 INFO Reading data HITS and writing to a dataframe.
root 2023-12-26 11:31:10,521 INFO Renaming columns HITS.
root 2023-12-26 11:31:10,522 INFO Clearing data HITS.
root 2023-12-26 11:31:10,568 INFO Start zagruzka v bazu logs api HITS.
root 2023-12-26 11:31:10,623 INFO Start zagruzka dannih - ym_hits_stranitsi_new.
root 2023-12-26 11:31:10,803 INFO End zagruzka dannih - ym_hits_stranitsi_new.
root 2023-12-26 11:31:10,803 INFO Start zagruzka dannih - ym_hits_obshee_new.
root 2023-12-26 11:31:11,092 INFO End zagruzka dannih - ym_hits_obshee_new.
root 2023-12-26 11:31:11,092 INFO Start zagruzka dannih - ym_hits_deystviya_new.
root 2023-12-26 11:31:11,202 INFO End zagruzka dannih - ym_hits_deystviya_new.
root 2023-12-26 11:31:11,202 INFO Start zagruzka dannih - ym_hits_ad_new.
root 2023-12-26 11:31:11,310 INFO End zagruzka dannih - ym_hits_ad_new.
root 2023-12-26 11:33:42,894 INFO Step_1_visit. Creating a log.
root 2023-12-26 11:33:43,200 INFO Code status 200
NoneType: None
root 2023-12-26 11:33:43,200 INFO Step_1_visit. Successful log request.
root 2023-12-26 11:33:43,200 INFO Step_1_visit. Request number 33139144.
root 2023-12-26 11:33:43,200 INFO Step_1_visit. Request status created.
root 2023-12-26 11:33:43,200 INFO Step_2_visit. Log processing status.
root 2023-12-26 11:33:43,436 INFO Step_2_visit. Loading data. Code 200.
root 2023-12-26 11:35:12,985 INFO Step_2_visit. Number of parts - 0.
root 2023-12-26 11:35:12,985 INFO Step_2_visit. Request status processed.
root 2023-12-26 11:35:12,985 INFO Step_3_visit. Loading the log.
root 2023-12-26 11:35:13,336 INFO Step_3_visit. Loading a log from one part.
root 2023-12-26 11:35:13,337 INFO Step_3_visit. Loading 0 parts of the log.
root 2023-12-26 11:35:13,337 INFO Step_4_visit. Deleting a log.
root 2023-12-26 11:35:13,610 INFO Step_4_visit. Successful log deletion # 33139144.
root 2023-12-26 11:35:13,610 INFO Step_4_visit. Deleting variables.
root 2023-12-26 11:35:13,611 INFO Start clearing data VISITS.
root 2023-12-26 11:35:13,611 INFO Reading data VISITS and writing to a dataframe.
root 2023-12-26 11:35:13,623 INFO Renaming columns VISITS.
root 2023-12-26 11:35:13,625 INFO Clearing data VISITS.
root 2023-12-26 11:35:13,674 INFO Start zagruzka v bazu logs api VISITS.
root 2023-12-26 11:35:13,724 INFO Start zagruzka dannih - ym_visits_obshee_new.
root 2023-12-26 11:35:13,846 INFO End zagruzka dannih - ym_visits_obshee_new.
root 2023-12-26 11:35:13,846 INFO Start zagruzka dannih - # ym_visits_detali_new.
root 2023-12-26 11:35:13,929 INFO End zagruzka dannih - ym_visits_detali_new.
